<div class="d-flex vh-100">
  <!-- Sidebar -->
  <nav class="bg-primary text-white p-3" style="width: 220px;">
    <h4 class="mb-4">User Panel</h4>
    <ul class="nav flex-column">
      <li class="nav-item mb-2">
        <a 
          class="nav-link text-white" 
          [class.active]="activeTab === 'dashboard'"
          style="cursor:pointer"
          (click)="setActiveTab('dashboard')"
        >Dashboard</a>
      </li>
      <li class="nav-item mb-2">
        <a 
          class="nav-link text-white" 
          [class.active]="activeTab === 'items'"
          style="cursor:pointer"
          (click)="setActiveTab('items')"
        >Items</a>
      </li>
      <!-- NEW: Categories tab -->
      <li class="nav-item">
        <a 
          class="nav-link text-white" 
          [class.active]="activeTab === 'categories'"
          style="cursor:pointer"
          (click)="setActiveTab('categories')"
        >Categories</a>
      </li>
    </ul>
  </nav>
  <!-- Main Content -->
  <div class="flex-grow-1 d-flex flex-column">
    <!-- Top Bar -->
    <div class="d-flex justify-content-end align-items-center p-3 border-bottom">
      <div ngbDropdown>
        <button class="btn btn-light" id="userDropdown" ngbDropdownToggle>
          <i class="bi bi-person-circle fs-4"></i>
        </button>
        <ul ngbDropdownMenu aria-labelledby="userDropdown" class="dropdown-menu-end">
          <li><a class="dropdown-item" href="#" (click)="logout()">Logout</a></li>
        </ul>
      </div>
    </div>
    <!-- Content Area Dashboard -->
    <div class="p-4" *ngIf="activeTab === 'dashboard'">
      <h2>Dashboard</h2>
    </div>
    <!-- Content Area Items -->
    <div class="p-4" *ngIf="activeTab === 'items'">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">Items</h2>
        <button class="btn btn-success" (click)="onAddItem()">Add Item</button>
      </div>

      <form *ngIf="showAddForm" class="border p-3 mb-3 bg-light rounded" (ngSubmit)="submitNewItem()">
        <div class="row g-2">
          <div class="col-md-2">
            <select class="form-control" [(ngModel)]="newItem.categoryId" name="categoryId" required>
              <option value="" disabled selected>Select Category</option>
              <option *ngFor="let cat of categories" [value]="cat.id">{{cat.name}}</option>
            </select>
          </div>
          <div class="col-md-2">
            <input class="form-control" placeholder="Name" [(ngModel)]="newItem.name" name="name" required>
          </div>
          <div class="col-md-2">
            <input class="form-control" placeholder="Description" [(ngModel)]="newItem.description" name="description" required>
          </div>
          <div class="col-md-1">
            <input class="form-control" placeholder="Price" type="number" [(ngModel)]="newItem.price" name="price" required>
          </div>
          <div class="col-md-2">
            <input class="form-control" placeholder="Ingredients" [(ngModel)]="newItem.ingredients" name="ingredients">
          </div>
          <div class="col-md-1">
            <input class="form-control" placeholder="Weight" [(ngModel)]="newItem.weight" name="weight">
          </div>
          <div class="col-md-2">
            <input class="form-control" placeholder="Image URL" [(ngModel)]="newItem.image" name="image">
          </div>
          <!-- <div class="col-md-2">
            <input class="form-control" type="file" (change)="onImageSelected($event)">
          </div> -->
          <div class="col-md-1 d-flex align-items-center">
            <label class="me-1">Veg</label>
            <input type="checkbox" [(ngModel)]="newItem.isVeg" name="isVeg">
          </div>
          <div class="col-md-1 d-flex align-items-center">
            <label class="me-1">Active</label>
            <input type="checkbox" [(ngModel)]="newItem.isActive" name="isActive">
          </div>
        </div>
        <div class="mt-2">
          <button type="submit" class="btn btn-primary btn-sm me-2">
            {{ editMode ? 'Update' : 'Save' }}
          </button>
          <button type="button" class="btn btn-secondary btn-sm" (click)="cancelAddItem()">Cancel</button>
        </div>
      </form>

      <div *ngIf="successMessage" class="alert alert-success py-2 px-3 mb-2">
        {{ successMessage }}
      </div>

      <div *ngIf="errorMessage" class="alert alert-danger py-2 px-3 mb-2">
        {{ errorMessage }}
      </div>

      <!-- Search and page size controls -->
      <div class="row mb-2">
        <div class="col-md-6">
          <label>
            Show
            <select class="form-select d-inline-block w-auto mx-1" [(ngModel)]="pageSize" (change)="onPageSizeChange()">
              <option [ngValue]="5">5</option>
              <option [ngValue]="10">10</option>
              <option [ngValue]="25">25</option>
              <option [ngValue]="50">50</option>
            </select>
            entries
          </label>
        </div>
        <div class="col-md-6 text-end">
          <input type="search" class="form-control d-inline-block w-auto" style="min-width:200px;" placeholder="Search..." [(ngModel)]="searchText" (input)="onSearch()" />
        </div>
      </div>

      <table class="table table-bordered table-striped align-middle">
        <thead>
          <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Category</th>
            <th>Price</th>
            <th>Weight</th>
            <th>Veg</th>
            <th>Active</th>
            <th>Image</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of paginatedItems">
            <td>{{item.name}}</td>
            <td>{{item.description}}</td>
            <td>{{item.category}}</td>
            <td>{{item.price}}</td>
            <td>{{item.weight}}</td>
            <td>{{item.isVeg ? 'Yes' : 'No'}}</td>
            <td>{{item.isActive ? 'Yes' : 'No'}}</td>
            <td>
              <img [src]="item.image" alt="{{item.name}}" width="50" height="50">
            </td>
            <td>
              <button class="btn btn-sm btn-primary me-1" (click)="onEditItem(item)">Edit</button>
              <button class="btn btn-sm btn-danger" (click)="openDeleteModal(item.id)">Delete</button>
            </td>
          </tr>
          <tr *ngIf="paginatedItems.length === 0">
            <td colspan="8" class="text-center">No items found.</td>
          </tr>
        </tbody>
      </table>

      <!-- Pagination controls -->
      <nav>
        <ul class="pagination justify-content-end">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <button class="page-link" (click)="prevPage()" [disabled]="currentPage === 1">Previous</button>
          </li>
          <li class="page-item disabled">
            <span class="page-link">
              Page {{currentPage}} of {{totalPages}}
            </span>
          </li>
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <button class="page-link" (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
          </li>
        </ul>
      </nav>
    </div>
    <!-- Content Area Categories -->
    <div class="p-4" *ngIf="activeTab === 'categories'">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">Categories</h2>
        <button class="btn btn-success" (click)="onAddCategory()">Add Category</button>
      </div>

      <!-- Alerts -->
      <div *ngIf="successMessage" class="alert alert-success py-2 px-3 mb-2">
        {{ successMessage }}
      </div>
      <div *ngIf="errorMessage" class="alert alert-danger py-2 px-3 mb-2">
        {{ errorMessage }}
      </div>

      <!-- Add/Edit Category form -->
      <form *ngIf="showAddCategoryForm" class="border p-3 mb-3 bg-light rounded" (ngSubmit)="submitCategory()">
        <div class="row g-2 align-items-end">
          <div class="col-md-4">
            <label class="form-label">Category Name</label>
            <input class="form-control" placeholder="e.g. Pizza" [(ngModel)]="newCategory.name" name="categoryName" required>
          </div>
          <div class="col-md-3">
            <button type="submit" class="btn btn-primary btn-sm me-2">
              {{ editCategoryMode ? 'Update' : 'Save' }}
            </button>
            <button type="button" class="btn btn-secondary btn-sm" (click)="cancelAddCategory()">Cancel</button>
          </div>
        </div>
      </form>

      <!-- Search and page size controls -->
      <div class="row mb-2">
        <div class="col-md-6">
          <label>
            Show
            <select class="form-select d-inline-block w-auto mx-1" [(ngModel)]="catPageSize" (change)="onCatPageSizeChange()">
              <option [ngValue]="5">5</option>
              <option [ngValue]="10">10</option>
              <option [ngValue]="25">25</option>
              <option [ngValue]="50">50</option>
            </select>
            entries
          </label>
        </div>
        <div class="col-md-6 text-end">
          <input type="search" class="form-control d-inline-block w-auto" style="min-width:200px;" placeholder="Search..." [(ngModel)]="catSearchText" (input)="onCatSearch()" />
        </div>
      </div>

      <!-- Categories table -->
      <table class="table table-bordered table-striped align-middle">
        <thead>
          <tr>
            <th>Name</th>
            <th style="width:180px;">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let c of catPaginated">
            <td>{{ c.name }}</td>
            <td>
              <button class="btn btn-sm btn-primary me-1" (click)="onEditCategory(c)">Edit</button>
              <button class="btn btn-sm btn-danger" (click)="openDeleteModalForCategory(c.id)">Delete</button>
            </td>
          </tr>
          <tr *ngIf="catPaginated.length === 0">
            <td colspan="2" class="text-center">No categories found.</td>
          </tr>
        </tbody>
      </table>

      <!-- Pagination controls -->
      <nav>
        <ul class="pagination justify-content-end">
          <li class="page-item" [class.disabled]="catCurrentPage === 1">
            <button class="page-link" (click)="catPrevPage()" [disabled]="catCurrentPage === 1">Previous</button>
          </li>
          <li class="page-item disabled">
            <span class="page-link">Page {{catCurrentPage}} of {{catTotalPages}}</span>
          </li>
          <li class="page-item" [class.disabled]="catCurrentPage === catTotalPages">
            <button class="page-link" (click)="catNextPage()" [disabled]="catCurrentPage === catTotalPages">Next</button>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal (shared for items and categories) -->
<div class="modal fade show" tabindex="-1" [ngStyle]="{'display': showDeleteModal ? 'block' : 'none', 'background': showDeleteModal ? 'rgba(0,0,0,0.5)' : ''}" *ngIf="showDeleteModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-danger">Confirm Delete</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeDeleteModal()"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this {{ deleteType === 'category' ? 'category' : 'item' }}?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeDeleteModal()">Cancel</button>
        <button type="button" class="btn btn-danger" (click)="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>
</div>